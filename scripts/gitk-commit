#!/bin/bash

set -e -o pipefail

flags=()
for arg in "$@"; do
    if [[ "$arg" == --* ]]; then
        flags+=("$arg")
    fi
done


if git diff --cached --quiet; then
    echo "Ð˜Ð½Ð´ÐµÐºÑ Ð¿ÑƒÑÑ‚. ÐÐµÑ‡ÐµÐ³Ð¾ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑŒ."
    exit 0
else
    echo "Ð•ÑÑ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð¸Ð½Ð´ÐµÐºÑÐµ. Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚."

    diff=$(git diff --cached)

    commit_message=$(echo "$diff" | python3 "$(dirname "$0")/../generator.py")

    tmpfile=$(mktemp)
    echo "$commit_message" > "$tmpfile"

    echo -e "ðŸ“¦ ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚:\n----------------------\n$commit_message\n----------------------"

    git commit "${flags[@]}" -F "$tmpfile"

    rm "$tmpfile"
fi
